---
title: "STAT 545B Assignment B1"
author: "Yitong Zhao"
output: github_document
---

# Setup

Begin by loading test data and the required packages below: 

```{r message=FALSE}
suppressPackageStartupMessages(library(datateachr))
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(testthat))
```

# Exercise 1 & 2: Make and Document a Function

In the data analysis of STAT 545A, I repeated the code to calculate the summary statistics and create boxplot across different groups for comparison. Therefore, I would like to make a function called `summary_and_boxplot_by_group()` to do the job for me.

Below is the implementation of the function.

```{r}
#' @title Create summary statistics and boxplot across groups
#' 
#' @description This function calculates the summary statistics (min, max, mean, median) of a variable in a data frame
#' across different groups. It also creates a boxplot where x-axis represents groups and y-axis represents the variable.
#' 
#' @param data A data frame containing the data.
#' @param group The column containing different groups, which decides how the data will be grouped.
#' @param var A numeric vector. Summary statistics are computed based on it.
#' @param drop_na A logical value indicating whether NA values should be stripped before the computation proceeds.
#' If \code{TRUE}, NA values will be removed. If \code{FALSE}, NA values will be kept.
#' The default value is \code{TRUE}.
#' @param alpha A numeric value representing the transparency of the boxplot.
#' The default value is 0.5,
#' @param scale_y A logical value indicating whether the y-axis of the boxplot should be transformed to log10 scale.
#' If \code{TRUE}, y-axis will be scaled, otherwise \code{FALSE}. The default value is \code{FALSE}.
#' 
#' @return A list containing (1) a tibble of summary statistics and, (2) the boxplot.


summary_and_boxplot_by_group <- function(data, group, var, drop_na = TRUE, alpha = 0.5, scale_y = FALSE) {
  if(!is.numeric(data[[var]])) {
    stop('Sorry, this function only works for numeric column!\n',
         'You have provided an object of class: ', class(data[[var]])[1])
  }
  if (!is.numeric(alpha)) {
    stop('Sorry, `alpha` has to be numeric!\n',
         'You have provided `alpha` of class: ', class(alpha)[1])
  }
  if (!is.logical(drop_na) || !is.logical(scale_y)) {
    stop('Sorry, `drop_na` and `scale_y` has to be logical!\n',
         'You have provided `drop_na` of class: ', class(drop_na)[1], '\n',
         'You have provided `scale_y` of class: ', class(scale_y)[1])
  }
  var = sym(var)
  group = sym(group)
  
  # compute min, max, mean and median of variable `var` grouped by `group`
  summary <- data %>%
    group_by({{group}}) %>%
    summarise(min = min({{var}}, na.rm = drop_na),
              max = max({{var}}, na.rm = drop_na),
              mean = mean({{var}}, na.rm = drop_na),
              median = median({{var}}, na.rm = drop_na),
              n = n()
    )
  
  # create boxplot
  plot <- data %>%
    ggplot(aes({{group}}, {{var}})) +
    geom_boxplot(alpha = alpha)
  
  if (scale_y) {
    plot <- plot + scale_y_log10()
  }
  
  result <- list(summary, plot)
  return (result)
}
```

# Exercise 3: Examples

The `apt_buildings` dataset is used in the examples. With the function `summary_and_boxplot_by_group()`, we can get the summary statistics and boxplot of `no_of_units` grouped by `property_type` with only one line of code.

```{r}
summary_and_boxplot_by_group(apt_buildings, "property_type", "no_of_units")
```

The above boxplot is hard to read because of some outliers. We can set the parameter `scale_y` to `TRUE` to make the plot look better.

```{r}
summary_and_boxplot_by_group(apt_buildings, "property_type", "no_of_units", scale_y = TRUE)
```

The function can only calculate the summary statistics of numeric variables. If non-numeric column is passed to the third argument `var`, an error will occur.

```{r error=TRUE}
summary_and_boxplot_by_group(apt_buildings, "property_type", "air_conditioning")
```


# Exercise 4: Test the Function


